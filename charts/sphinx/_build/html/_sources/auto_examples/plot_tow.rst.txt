
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_tow.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_tow.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_tow.py:


Time of Week Chart
==================

Makes an example of a time of week chart.

.. GENERATED FROM PYTHON SOURCE LINES 7-34

.. code-block:: default


    from sqlalchemy import create_engine
    import matplotlib.pyplot as plt
    import matplotlib as mpl
    import pandas as pd 
    import configparser
    from psycopg2 import connect
    import psycopg2.sql as pg
    import pandas.io.sql as pandasql
    import numpy as np 
    import datetime
    import math
    import rick
    import geopandas as gpd
    import os
    import shapely
    from shapely.geometry import Point
    os.environ["PROJ_LIB"]=r"C:\Users\rliu4\AppData\Local\Continuum\anaconda3\Library\share"
    import importlib
    import matplotlib.ticker as ticker
    import matplotlib.font_manager as font_manager


    CONFIG = configparser.ConfigParser()
    CONFIG.read(r'C:\Users\rliu4\Documents\Python\config.cfg')
    dbset = CONFIG['DBSETTINGS']
    con = connect(**dbset)


.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/cnangini/PROJECTS/bdit_python_utilities/charts/sphinx/example/plot_tow.py", line 32, in <module>
        dbset = CONFIG['DBSETTINGS']
      File "/usr/lib/python3.5/configparser.py", line 956, in __getitem__
        raise KeyError(key)
    KeyError: 'DBSETTINGS'




.. GENERATED FROM PYTHON SOURCE LINES 35-39

Data Collection
----------------

This Section grabs and formats the data.

.. GENERATED FROM PYTHON SOURCE LINES 39-65

.. code-block:: default

    query = '''

    WITH sum AS (

    SELECT pickup_datetime, hr, sum(count) as count, extract(month from pickup_datetime) as mon, extract(year from pickup_datetime) as yr,
    extract(dow from pickup_datetime) as dow FROM ptc.trip_data_agg_ward_25


    WHERE pickup_datetime > '2018-08-31'
    GROUP BY pickup_datetime, hr

    )
    , collect AS (
    SELECT  avg(count) as count, hr, dow from sum
    group by hr, dow)

    SELECT period_name, period_uid, count, hr, CASE WHEN dow = 0 THEN 7 ELSE dow END AS dow, 
    CASE WHEN swatch IS NULL THEN '#999999' ELSE swatch END AS swatch
    FROM collect
    LEFT JOIN ptc.period_lookup_simple ON dow=period_dow AND hr=period_hr
    LEFT JOIN ptc.periods_simple USING (period_uid)
    ORDER BY dow, hr

    '''
    count_18 = pandasql.read_sql(query,con)

    fig, ax, prop = rick.charts.tow_chart(data = count_18['count'], ylab='Trips', ymax = 14000, yinc= 3500)

.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.002 seconds)


.. _sphx_glr_download_auto_examples_plot_tow.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_tow.py <plot_tow.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_tow.ipynb <plot_tow.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
